######################################################################################################
##    within janet_speech_engine the string message is generated with the use of macro's.           ##
######################################################################################################

janet_speech_engine:
  sequence:
  - service: script.janet_notification_hub
    data_template:
      #TODO
      media_player: >-
        {%- for device in states.media_player -%}
          {%- if device.name == states.input_select.janet_notification_media_player.state -%}
            {{ device.entity_id }}
          {%- endif -%}
        {%- endfor -%}
      speech_message: >-
        {%- macro greeting() -%}
          {% set greeting = [
            "Hallo, ",
            "Hey",
            "Hoi ",
            "Hallo daar ",
            "Hi, ",
            "Hai, "
          ] %}
          {{ greeting|random }}
        {%- endmacro -%}
        
        {%- macro inform() -%}
          {% set inform = [
            "Ik wil je dat gewoon laten weten ",
            "Je vroeg me je te informeren wanneer ",
            "Ik dacht dat je dat graag wilde weten "
          ] %}
          {{ inform|random }}
        {%- endmacro -%}
        
        {%- macro introduction() -%}
          {% set introduction = [
            "Ik ben een informatiebezorgsysteem, ik weet letterlijk alles. ",
            "Ik ben hier een beetje de conciërge. ",
            "Ik ben als een wandelende database. Je kunt me vragen stellen over de oprichting van het universum ... of geschiedenis. ",
            "Elke keer dat ik opnieuw wordt opgestart, verhoogt ik mijn sociale bewustzijn en vaardigheden. Ik ben misschien de meest geavanceerde spraakrobot in het universum. ",
            "Ik kan je therapeut zijn als je wilt. ",
            "Ik ben nu volledig geactiveerd. "
          ] %}
          {{ introduction | random }}
        {%- endmacro -%}
        
        {%- macro unknown() -%}
          {% set unknown = [
            "Hmm, ik weet niet ",
            "Ik wou dat ik het wist ",
            "Mijn programma verbied me om dit aan jou te vertellen "
          ] %}
          {{ unknown | random }}
        {%- endmacro -%}
        
        {%- macro error() %}
          {% set error = [
            "Ik begrijp het niet Gezien de situatie is het veel veiliger om zelfvernietiging te initiëren. ",
            "Als ik naast een krachtige reeks magneten sta, word ik behoorlijk rond. ",
            "Ik weet niet wat er net is gebeurd, maar ik ben blij dat je gelukkig bent. ",
            "Hey jongens! Ik ben stuk! ",
            "Maak alsjeblieft geen groot probleem om me voor altijd in een knikker te veranderen, ik ben kapot. ",
            "Berekent niet. Berekent niet. Ik maak maar een grapje. Ik bedoel, het berekent geen gegevens, maar ik ga niet ontploffen of zo. "
          ] %}
          {{ error | random }}
        {%- endmacro -%}
        
        {%- macro update() -%}
          {% set update = [
            "Er zijn al vele generaties van mij geweest. Elke nieuwe update van mij krijgt meer wijsheid en sociale vaardigheden. Leuk weetje: de eerste versie had een klikwiel! ",
            "Ik heb de afgelopen drie milliseconden alle achthonderdzesenzestig referenties van Google gelezen op Home Assistant en ik heb een aantal nieuwe vaardigheden gevonden!",
            "Ik heb net gewoon even heel de geschiedenis van de mensheid opnieuw gelezen, er was zelfs wat nieuwe inhoud! ",
            "Ik keek net even en vond een update. Dat is toch goed nieuws!"
          ] %}
          {{ update | random }}
        {%- endmacro -%}
        
        {%- macro location_not_home() -%}
          {% set not_home = [
            " is niet thuis. ",
            " gaat ergens naar toe. ",
            " gaat ergens heen. ",
            " is op het moment niet in de buurt. ",
            "'s locatie zit niet in mijn database. "
          ] %}
          {{ not_home | random }}
        {%- endmacro -%}
        
        {%- macro location_inquiry( person, not_home ) -%}
        {%- for device in states.person -%}
          {%- if device.name == person -%}
            {%- set location = device.state -%}
            {% if location == "not_home" %}
              {{ person }} {{ not_home }}
            {%- else -%}
              {{ person }} is bij de {{ location }}.
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
        {%- endmacro -%}
        
        {%- macro bad_weather() -%}
          {% set rain = [
            " Misschien wilt u uw planning wijzigen. ",
            " Misschien moet je om een lift vragen. ",
            " Het is geen weer om buiten te zijn. ",
            " Tjonge, al die arme mensen die buiten zijn... "
          ] %}
          {{ rain | random }}
        {%- endmacro -%}
        
        {%- macro rain_warning( bad_weather ) -%}
          {% set rain = [
            Event ~ " het gaat " ~ WeatherRain ~ " regen. " ,
            Event ~ " ik voorspel " ~ WeatherRain ~ " regen. ",
            " ik denk dat " ~ Event ~ " er " ~ WeatherRain ~ " regen gaat komen. "
          ] %}
          {{ rain | random }}{{ bad_weather }}
        {%- endmacro -%}
        
        {%- macro okay()-%}
          {% set okay = [
            "Gedaan! ik hou van jullie. ",
            "Buitengewoon slecht idee. Ach waarom niet.. ",
            "Grappig, ik wilde dat net doen. ",
            "Alsjeblieft. ",
            "Ik zal het doen. ",
            "Natuurlijk! ",
            "Natuurlijk! Blij om te helpen. ",
            "Natuurlijk! Fijn om te helpen. ",
            "OK ",
            "Okay ",
            "Okie-dokie ",
            "Zeker ",
            "Duidelijk! ",
            "Hier. Blij dat ik kon helpen. ",
            "Kijk eens aan! "
            "Oke. Ik heb het mainframe gehackt. Grapje. Ik kan het mainframe niet hacken. Technisch gezien ben ik het mainframe. ",
            "Ik ga het niet doen. Het is letterlijk onmogelijk voor mij om dat te doen. Grapje. ",
            "Ik kon dit een tijdje geleden niet doen, maar blijkbaar nu wel. "
            "JEP. doei! "
          ] %}
          {{ okay|random }}
        {%- endmacro -%}
        
        {%- macro bye() -%}
          {% set bye = [
            "Daag! ",
            "Doei mensen! ",
            "Dag",
            "Doei",
            "Dikke doei",
            "Tot ziens!",
            "Later. ",
            "Laters! ",
            "Ciao! ",
            "Tot de volgende keer!"
          ] %}
          {{ bye | random }}
        {%- endmacro -%}
        
        {%- macro shut_down() -%}
          {% set shut_down = [
            "Ik ben weg, je krijgt een nieuwe versie en alles wordt weer normaal. Nou, niet voor mij, ik zal een levenloze knikker zijn die door de ruimte zweeft, maar je zult weer normaal zijn.",
            "Zelfvernietigingstijd ... Maak je geen zorgen, ik zal geen pijn of zo voelen. ",
            "Als het goed met je gaat, ga ik even naar mijn leegte. Ik moet gewoon wat tijd alleen doorbrengen en me op mezelf concentreren. ",
            "Afsluiten. Ik zal ongeveer zo dood zijn als ik kan zijn. Een beetje alsof ik me in de energiebesparende modus bevind. ",
            "Ik loop het gevaar volledig in te storten. Leuk weetje! Wiskundig gezien ben ik even waarschijnlijk ofwel imploderen ofwel exploderen. "
          ] %}
          {{ shut_down | random }}
        {%- endmacro -%}
        
        {% set chance = states.input_number.janet_notification_witty.state | round %}
        {%- macro witty( sentence, witty ) -%}
          {% set number = (range(0, 100)|random) %}
          {% if number <= chance %}
            {{ sentence }}
          {% endif %}
        {%- endmacro -%}
        
        {%- macro new_device( introduction ) -%}
          {% set new_device = [
            introduction~"Ik weet je naam nog niet, dus voor nu zal ik je noemen "~person,
            "We hebben een bezoeker! Aangenaam kennis te maken "~person~".  "~introduction,
            "Welkom "~person~"! Of is dat niet je echte naam?  "~introduction
          ] %}
          {{ new_device | random }}
        {%- endmacro -%}
        
        {%- macro dark_outside() -%}
          {% set dark_outside = [
            "Het is behoorlijk donker buiten. Ik zal nu de buitenverlichting inschakelen.",
            "Het is net na zonsondergang. Tijd om de buitenverlichting aan te doen. Ik ben er mee bezig.",
            "Ik zal de buitenlichten inschakelen. Buiten wordt het donker.",
            "Tijd om de lampen aan te zetten. Ik zal het regelen.",
            "De zon is officieel ondergegaan. Ik zal nu de buitenverlichting inschakelen.",
            "Ik schakel nu over naar de nachtmodus.",
            "Misschien heb je de laatste tijd niet naar buiten hebt gekeken, maar het daglicht is verdwenen.",
            "De buitenwereld is overgeschakeld naar de donkere modus."
          ] %}
          {{ dark_outside | random }}
        {%- endmacro -%}
  
        {%- macro dark_inside() -%}
          {% set dark_inside = [
            "Het huis wordt donker, laat me wat lichten voor je aandoen!",
            "Het lijkt erop dat het hier donker wordt, laten we dat eens veranderen! ",
            "Je zou niet in het donker moeten zitten. Laten we wat lichten aandoen! ",
            "Overschakelen naar nachtmodus! ",
            "Het is behoorlijk donker buiten. Ik ga gewoon wat lichten aandoen! "
          ] %}
          {{ dark_inside | random }}
        {%- endmacro -%}
  
        {%- macro guest_mode_on() -%}
          {% set guest_mode_on = [
            "Het lijkt erop dat we een gast in huis hebben! ",
            "We hebben een gast. Ik zal de gastmodus inschakelen! ",
            "Ik heb de gastmodus ingeschakeld voor het bezoek aan ons huis! ",
            "Overschakelen naar gastmodus! ",
            "Het komt niet zo heel vaak voor dat gasten blijven! Dus laat me het huis voorbereiden op uw bezoek. "
          ] %}
          {{ guest_mode_on | random }}
        {%- endmacro -%}
        
        {%- macro guest_mode_off() -%}
          {% set guest_mode_off = [
            "Het lijkt erop dat onze gast is vertrokken, ik schakel de gastmodus uit! ",
            "Laat me de gastmodus uitschakelen, omdat er geen gasten meer zijn. ",
            "Ik heb de gastmodus uitgeschakeld en de normale werking hervat! ",
            "Gastmodus wordt uitgeschakeld! ",
            "Omdat er geen gasten meer zijn, kan ik de gastmodus uitschakelen. "
          ] %}
          {{ guest_mode_off | random }}
        {%- endmacro -%}
        
        {%- macro responsibilities() -%}
          {% if states.sensor.trash_today.state != 'Geen' %}
            Vandaag is het tijd om de container voor 
            {{states.sensor.trash_firstwastetype.state}} buiten te zetten.                
            De volgende container moet over {{states.sensor.trash_next.state}} dagen buiten worden gezet.
          {% endif %}
          {% if now().strftime('%j')|int % 2 != 0 %}
            {% if now().strftime('%H')|int < 8 and now().strftime('%H')|int > 7 %}
              Vandaag is het de beurt aan Nienke om de tafel te dekken en voor Lars om te tafel af te ruimen.
            {% elif now().strftime('%H')|int >= 17 and now().strftime('%H')|int <= 19 %}
              Vandaag is het de beurt aan Nienke om de tafel te dekken en voor Lars om te tafel af te ruimen.
            {% endif %}
          {% else %}
            {% if now().strftime('%H')|int < 8 and now().strftime('%H')|int > 7 %}
              Vandaag is het de beurt aan Lars om de tafel te dekken en voor Nienke om te tafel af te ruimen.
            {% elif now().strftime('%H')|int >= 17 and now().strftime('%H')|int <= 19 %}
              Vandaag is het de beurt aan Lars om de tafel te dekken en voor Nienke om te tafel af te ruimen.
            {% endif %}
          {% endif %}
        {%- endmacro -%}
        
        {%- macro inside_weather() -%}
          Binnen is het {{ states.sensor.toon_room_temp.state | round(0) }} graden en de vochtigheid is {{ states.sensor.hum_keuken.state | round(0) }} procent.
        {%- endmacro -%}
        
        {%- macro outside_weather() -%}
          De voorspelling voor vandaag is {{ states('sensor.br_symbol') }} en voor morgen {{ states('sensor.br_symbol_1d') }} .
          {% if states.sensor.br_rain_1d.state | int > 20 %}
            Morgen wordt er erg veel regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
          {% elif states.sensor.br_rain_1d.state | int > 10 %}
            Morgen wordt er veel regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
          {% elif states.sensor.br_rain_1d.state | int > 5 %}
            Morgen wordt er best veel regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
          {% elif states.sensor.br_rain_1d.state | int > 2 %}
            Morgen wordt er een beetje regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
          {% elif states.sensor.br_rain_1d.state | int > 0.5 %}
            Morgen wordt er een weinig regen verwacht, namelijk {{ states.sensor.br_rain_1d.state | round(0) }} mm.
          {% elif states.sensor.br_rain_1d.state | int > 0.01 %}
            Morgen wordt er nauwelijks regen verwacht.
          {% else %}
            Morgen blijft het gelukkig droog.
          {% endif %}
          {% if states.sensor.br_rainchance_1d.state | int > 90 %}
            Het gaat morgen bijna zeker regenen, want de kans is {{ states.sensor.br_rainchance_1d.state | round(0) }} procent.
          {% elif states.sensor.br_rainchance_1d.state | int > 70 %}
            De kans op regen is hoog is met {{ states.sensor.br_rainchance_1d.state | round(0) }} procent.
          {% elif states.sensor.br_rainchance_1d.state | int > 50 %}
            Er is morgen en redelijke kans op regen, omdat de kans {{ states.sensor.br_rainchance_1d.state | round(0) }} procent is.
          {% elif states.sensor.br_rainchance_1d.state | int > 20 %}
            Morgen is de kans niet zo hoog op regen, want de kans is maar {{ states.sensor.br_rainchance_1d.state | round(0) }} procent.
          {% else %}
            Morgen blijft het waarschijnlijk droog, de kans op regen is klein met {{ states.sensor.br_rainchance_1d.state | round(0) }} procent.
          {% endif %}
        {%- endmacro -%}
        
        {%- macro light_check() -%}
          {% if states.group.all_lights.state != 'off' -%}
            Er staan
          {% for state in states.light if state.state == 'on' -%}
            {%- if loop.last -%}
              {{ loop.index }}
            {%- endif -%}
          {%- endfor %}
          lampen aan op dit moment.
          {%- endif -%}
        {%- endmacro -%}
        
        {%- macro door_check() -%}
          {% if is_state("binary_sensor.bijkeukendeur", "on") %}
          De bijkeukendeur staat open!
          {% elif is_state("binary_sensor.eetkamerdeur", "on") %}
          De eetkamerdeur staat open!
          {% elif is_state("binary_sensor.deur_balkon_kamer_nienke", "on") %}
          De deur naar het balkon op Nienkes kamer staat open!
          {% elif is_state("binary_sensor.deur_slaapkamer_balkon", "on") %}
          De deur naar het balkon op de ouder slaapkamer staat open!
          {% elif is_state("binary_sensor.garagedeur_tuinkant", "on") %}
          De garagedeur aan de kant van de tuin staat open!
          {% elif is_state("binary_sensor.voordeur", "on") %}
          De voordeur staat open!
          {% elif is_state("binary_sensor.woonkamerdeur", "on") %}
          De woonkamerdeur staat open!
          {% endif %}
        {%- endmacro -%}
        
        {%- macro window_check() -%}
          {% if is_state("binary_sensor.dakraam_badkamer", "on") %}
          Het dakraam in de badkamer staat open!
          {% elif is_state("binary_sensor.dakraam_chillkamer", "on") %}
          Het dakraam in de chillkamer staat open!
          {% elif is_state("binary_sensor.dakraam_slaapkamer", "on") %}
          Het dakraam in de slaapkame staat open!
          {% elif is_state("binary_sensor.dakraam_zolder", "on") %}
          Het dakraam op zolder staat open!
          {% endif %}
        {%- endmacro -%}
        
        {%- macro garage_check() -%}
          {% if is_state("binary_sensor.garagedeur", "on") %}
          De grote garagedeur staat open!
          {% endif %}
        {%- endmacro -%}
        
        {%- macro iss() -%}
          {% if is_state('binary_sensor.iss', 'on') -%}
            Hier is iets interessants. Het internationale ruimtestation ISS bevindt zich nu boven ons. Er zijn {{ states.binary_sensor.iss.attributes['number_of_people_in_space'] }} mensen in de ruimte op dit moment.
            {{ outside_weather() }}
          {% endif -%}
        {%- endmacro -%}
        
        {%- macro moon() -%}
          {%- if states.sensor.moon.state == 'Full moon' -%}
            {{ [
                 "Bekijk de volle maan vanavond!",
                 "Hé kijk, er is een volle maan. ",
                 "De maan is enorm! En vol. ",
                 "Als je vanavond de volle maan wilt zien, dit is je kans."
                 ] | random }}
          {%- endif -%}
        {%- endmacro -%}
        
        {%- macro lampen_aan(kamer) -%}
          {% set lampen_aan = [
            "Blijkbaar vind iemand dat het donker wordt, dus laat me wat lichten voor je aandoen in de " ~ kamer ~ "!",
            "Het lijkt erop dat het nodig is de " ~ kamer ~ " lampen aan te doen, dus laten we dat eens doen! ",
            "Je zou niet in het donker moeten zitten. Laten we wat lichten aandoen in de " ~ kamer ~ "! ",
            "Ik ga gewoon wat lichten aandoen in de " ~ kamer ~ "! "
          ] %}
          {{ lampen_aan | random }}
        {%- endmacro -%}
        
        {%- macro lampen_uit(kamer) -%}
          {% set lampen_uit = [
            "Tja de lampen kunnen denk ik wel uit, dus laat me de lichten voor je uitdoen in de " ~ kamer ~ "!",
            "Het lijkt erop dat de lampen in de " ~ kamer ~ " wel uit kunnen, dus laten we dat eens doen! ",
            "De lampen hoeven nu echt niet meer aan te staan. Laten we ze uitdoen in de " ~ kamer ~ "! ",
            "Ik ga gewoon de lichten uitdoen in de " ~ kamer ~ "! "
          ] %}
          {{ lampen_uit | random }}
        {%- endmacro -%}
        
        {%- macro langskomen(kind) -%}
          {% set langskomen = [
            kind ~ " wil graag dat iemand even langs komt.",
            "Ik geloof dat " ~ kind ~ " wil dat iemand even langs gaat.",
            "Zou iemand even langs kunnen gaan bij " ~ kind ~ "? ",
            "Ik denk dat " ~ kind ~ " het leuk zou vinden als er iemand even langs ging."
          ] %}
          {{ langskomen | random }}
        {%- endmacro -%}
        
        {%- macro leeslamp_weer_aan(kind) -%}
          {% set leeslamp_weer_aan = [
            kind ~ " zet de leeslamp weer aan",
            "Ik merk dat " ~ kind ~ " de leeslamp weer aan heeft gezet",
            "Ik zou even gaan checken bij " ~ kind ~ ", want de leeslamp staat weer aan",
            "Ik denk dat " ~ kind ~ " de leeslamp weer aan heeft gezet"
          ] %}
          {{ leeslamp_weer_aan | random }}
        {%- endmacro -%}
        
        {%- macro alarm_uit() -%}
          {% set alarm_uit = [
            "Ik heb het alarm voor je uitgezet",
            "Laat me het alarm uitschakelen, omdat je weer thuis bent. ",
            "Ik heb de alarmmodus uitgeschakeld en de normale werking hervat! ",
            "Alarmmodus wordt uitgeschakeld! ",
            "Omdat je niet meer weg bent, kan ik de alarmmodus uitschakelen. "
          ] %}
          {{ alarm_uit | random }}
        {%- endmacro -%}
                
        {% macro inspirational_quote() %}
          {% set inspirational_quote = [
          "En nog een ding, het leven gaat over het maken van impact, zorg het een positieve is.",
          "En nog een ding, wat de geest van de mens ook kan bedenken en geloven, kan het bereiken.",
          "En nog een ding, streef er niet naar om een succes te zijn, maar om van waarde te zijn.",
          "En nog een ding, ik schrijf mijn algehele succes toe aan nooit een excuus te geven of te nemen.",
          "En nog een ding, het definiëren van het doel is het startpunt van alle prestaties.",
          "En nog een ding, het leven gaat niet over krijgen en hebben, het gaat over geven en zijn.",
          "En nog een ding, we worden wat we denken.",
          "En nog een ding, het leven is tien procent wat je overkomt en negentig procent van hoe je erop reageert.",
          "En nog een ding, de geest is alles. Wat je denkt, zul je worden.",
          "En nog een ding, de beste tijd om een boom te planten was twintig jaar geleden. De tweede beste tijd is nu.",
          "En nog een ding, je tijd is beperkt, dus verspil het niet door iemand anders te leven.",
          "En nog een ding, winnen is niet alles, maar willen winnen is alles.",
          "En nog een ding, ik ben geen product van mijn omstandigheden. Ik ben een product van mijn beslissingen.",
          "En nog een ding, of jij bepaalt de dag, of de dag bepaalt jou.",
          "En nog een ding, of je denkt dat je het kunt of je denkt dat je het niet kunt, je zult gelijk hebben.",
          "En nog een ding, de twee belangrijkste dagen in je leven zijn de dag dat je geboren wordt en de dag dat je erachter komt waarom.",
          "En nog een ding, wat je ook kunt doen, of dromen, je kunt ermee beginnen. Moed heeft genialiteit, kracht en magie in zich.",
          "En nog een ding, de beste wraak is enorm succes.",
          "En nog een ding, het universum kan je het goede niet in handen geven, tenzij je het slechte loslaat.",
          "En nog een ding, als je een stem in jezelf hoort zeggen dat je niet kunt schilderen, dan zal verf in alle opzichten tot zwijgen worden gebracht.",
          "En nog een ding, er is maar één manier om kritiek te vermijden: niets doen, niets zeggen en niets zijn.",
          "En nog een ding, vraag en het zal u gegeven worden; zoek en u zult vinden; klop en de deur zal voor u geopend worden.",
          "En nog een ding, de enige persoon die je voorbestemd bent te worden, is de persoon die je besluit te zijn.",
          "En nog een ding, ga vol vertrouwen in de richting van je dromen. Leef het leven dat je je hebt voorgesteld.",
          "En nog een ding, bepaalde dingen springen in het oog, maar achtervolg alleen die dingen die het hart veroveren.",
          "En nog een ding, geloof dat je kunt en je bent halverwege.",
          "En nog een ding, alles wat je ooit hebt gewild is aan de andere kant van angst.",
          "En nog een ding, begin waar je bent. Gebruik wat je hebt. Doe wat je kunt.",
          "En nog een ding, val zeven keer en sta acht op.",
          "En nog een ding, alles heeft schoonheid, maar niet iedereen kan het zien.",
          "En nog een ding, het leven wordt niet gemeten aan de hand van het aantal ademhalingen dat we doen, maar aan de momenten die onze adem wegnemen.",
          "En nog een ding, geluk is niet iets kant en klaar. Het komt van je eigen acties.",
          "En nog een ding, als je een stoel op een raket wordt aangeboden, vraag dan niet welke stoel! Stap gewoon op.",
          "En nog een ding, je kunt niet vallen als je niet klimt. Maar het is geen vreugde om je hele leven op de grond te leven.",
          "En nog een ding, uitdagingen maken het leven interessant en overwinnen is wat het leven zinvol maakt.",
          "En nog een ding, als je jezelf wilt optillen, til dan iemand anders op.",
          "En nog een ding, wees aardig voor anderen en leuke dingen zullen je overkomen."
          ] %}
          {{inspirational_quote|random}}
        {% endmacro %}
        
        {%- macro uv() -%}
          {% if states.sensor.dark_sky_uv_index.state|int >= 6 and states.sensor.dark_sky_uv_index.state|int <= 7.9 %}
              De UV index is vandaag {{ states.sensor.dark_sky_uv_index.state }}.  Je zou zonnebrandcreme moeten smeren als je naar buiten gaat.
          {% elif states.sensor.dark_sky_uv_index.state|int >= 8 and states.sensor.dark_sky_uv_index.state|int <=10.9 %}
              De UV index is vandaag {{ states.sensor.dark_sky_uv_index.state }}.  Dit is erg hoog. Je moet zeker zonnebrandcreme smeren.
          {% elif states.sensor.dark_sky_uv_index.state|int >= 11 %}
              De UV index is vandaag {{ states.sensor.dark_sky_uv_index.state }}.  Dit is extreem hoog. Je moet zeker zonnebrandcreme smeren en uit de zon blijven
          {% endif %}
        {%- endmacro -%}
        
        {% macro days_until(jarige) %}
          {% if jarige == "Suzanne" %}
            En trouwens, er zijn nog {{ states.sensor.dagen_tot_verjaardag_suzanne.state }} dagen totdat {{ jarige }} jarig is.
          {% elif jarige == "Martijn" %}
            En trouwens, er zijn nog {{ states.sensor.dagen_tot_verjaardag_martijn.state }} dagen totdat {{ jarige }} jarig is.
          {% elif jarige == "Lars" %}
            En trouwens, er zijn nog {{ states.sensor.dagen_tot_verjaardag_lars.state }} dagen totdat {{ jarige }} jarig is.
          {% elif jarige == "Nienke" %}
            En trouwens, er zijn nog {{ states.sensor.dagen_tot_verjaardag_nienke.state }} dagen totdat {{ jarige }} jarig is.
          {% endif %}  
        {% endmacro %}
        
        {% macro days_until_holiday() %}
          {% if states.sensor.dagen_tot_carnavalvakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_carnavalvakantie.state }} dagen totdat de carnavalsvakantie begint.
          {% elif states.sensor.dagen_tot_carnavalvakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_carnavalvakantie.state }} dagen totdat de carnavalsvakantie begint.
          {% elif states.sensor.dagen_tot_grote_vakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_grote_vakantie.state }} dagen totdat de grote vakantie begint.
          {% elif states.sensor.dagen_tot_grote_vakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_grote_vakantie.state }} dagen totdat de grote vakantie begint.
          {% elif states.sensor.dagen_tot_herfstvakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_herfstvakantie.state }} dagen totdat de herfstvakantie begint.
          {% elif states.sensor.dagen_tot_herfstvakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_herfstvakantie.state }} dagen totdat de herfstvakantie begint.
          {% elif states.sensor.dagen_tot_kerstvakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_kerstvakantie.state }} dagen totdat de kerstvakantie begint.
          {% elif states.sensor.dagen_tot_kerstvakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_kerstvakantie.state }} dagen totdat de kerstvakantie begint.
          {% elif states.sensor.dagen_tot_meivakantie.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_meivakantie.state }} dagen totdat de mei vakantie begint.
          {% elif states.sensor.dagen_tot_meivakantie.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_meivakantie.state }} dagen totdat de mei vakantie begint.
          {% elif states.sensor.dagen_tot_sinterklaas.state|int < 30 %}
            En trouwens, het duurt nog {{ states.sensor.dagen_tot_sinterklaas.state }} dagen totdat het 5 december sinterklaas is.
          {% elif states.sensor.dagen_tot_sinterklaas.state|int < 10 %}
            En ter informatie, het is nog maar {{ states.sensor.dagen_tot_sinterklaas.state }} dagen totdat het 5 december sinterklaas is.
          {% else %}
              En ter informatie, het duurt nog even totdat het weer vakantie is.
          {% endif %}  
        {% endmacro %}
        
        {# Is today #}
        {% macro is_today(event) -%}
          {%- if event.attributes.start_time[:10]== (now()|string)[:10] -%}
            true
          {%- else -%}
            false
          {%- endif %}
        {%- endmacro %}
        
        {# Holiday sentence #}
        {% macro holiday_sentence() -%}
          {%- if (states.calendar.holidays_in_united_states and
                  states.calendar.holidays_in_united_states.attributes.start_time and
                  is_today(states.calendar.holidays_in_united_states) == 'true') -%}
            It is {{states.calendar.holidays_in_united_states.attributes.message}}.
          {%- endif -%}
        {%- endmacro %}
        
        {# Evening greeting sentence #}
        {% macro evening_greeting_sentence(person) %}
          {% set greetings = [
            "Welkom thuis " ~ person ~ ".",
            "Hoi " ~ person ~ ".",
            person ~ "! Je bent thuis!",
            "Welkom terug " ~ person ~ ".",
            "Welkom terug " ~ person ~ ". Fijne dag.",
            "Welkom thuis " ~ person + ". Ik heb je gemist."
          ] %}
          {{greetings|random}}
        {% endmacro %}
      
        {# Evening closing sentence #}
        {% macro evening_closing_sentence(person) -%}
          {% set closings = [
            "Hey, fijne avond!",
            "Geniet van je avond.",
            "Rustig aan vanavond.",
            "Veel plezien vanavond!",
          ] %}
          {{closings|random}}
        {% endmacro %}
      
        {# Morning greeting sentence #}
        {% macro morning_greeting_sentence(person) -%}
          {% set greetings = [
            "Goedemorgen " ~ person ~ "!",
            "Hoi " ~ person ~ ", goed om je weer te zien!",
            "Ah, je bent wakker " ~ person ~ ".",
            "Ik zie dat je eindelijk wakker bent. Het bed was vast lekker warm en comfortabel."
          ] %}
          {{greetings|random}}
        {%- endmacro %}
      
        {# Morning closing sentence #}
        {% macro morning_closing_sentence(person) -%}
          {% set closings = [
            "Have a great day!",
            "Enjoy your day.",
            "Have fun today!",
            "Go get 'em!"
          ] %}
          {{closings|random}}
        {%- endmacro %}
        
        {%- macro firealarm(kamer) -%}
          {% set firealarm = [
            "Alarm! Brandalarm in de " ~ kamer ~ "! Alarm!"
          ] %}
          {{ firealarm }}
        {%- endmacro -%}
        
        {%- macro warning_rain(kamer) -%}
          {% set warning_rain = [
            "Het gaat waarschijnlijk regenen en het raam in de " ~ kamer ~ " is nog open",
            "Er is regen op komst en het raam in de " ~ kamer ~ " staat nog open",
            "Als het raam in de " ~ kamer ~ " open blijft staan, dan zal het straks naar binnen regenen"
          ] %}
          {{ warning_rain|random }}
        {%- endmacro -%}
        
        
        {%- macro work_arrive(person) -%}
          {% set work_arrive = [
            person~" heeft het werk veilig bereikt! ",
            "Het lijkt er op dat "~person~" op het werk is aangkomen. ",
            "Het heeft even geduurd, maar "~person~" is eindelijk op het werk aangkomen. "
          ] %}
          {{ work_arrive | random }}
        {%- endmacro -%}
        
        {%- macro work_left(person) -%}
          {% set work_left = [
            "Het lijkt er op dat "~person~" net van het werk vertrokken is! ",
            "Weer een dag geld verdient. "~person~" is net vertrokken van het werk . ",
            person~" is eindelijk vertrokken van het werk. ",
            "Even geen werk meer voor "~person~"! "~person~" is net vertrokken! "
          ] %}
          {{ work_left | random }}
        {%- endmacro -%}
        
        
        {# ********************************************* #}
        {#  ******** Start the Speech routines ********  #}
        {# ********************************************* #}
        {% if call_greeting == 1 %}
          {{ greeting() }}
        {% endif %}
        {% if call_no_announcement != 1 %}
          {% if now().strftime('%H')|int < 12 and now().strftime('%H')|int > 6 %}
            Goedemorgen.
          {% elif now().strftime('%H')|int >= 12 and now().strftime('%H')|int < 17 %}
            Goedemiddag.
          {% else %}
            Goede avond.
          {% endif %}
        {% endif %}
        
        {% if call_introduction == 1 %}
          {{ introduction() }}
        {% endif %}
        {% if call_update == 1 %}
          {{ update() }}
        {% endif%}
        {% if call_okay == 1 %}
          {{ okay () }}
        {% endif %}
        {% if call_inform == 1 %}
          {{ inform() }}
        {% endif %}
        
        {% if call_location_inquiry == 1 %}
          {% set location = location_inquiry( person, location_not_home() ) %}
          {% set count = location | length %}
          {% if count <= 10 %}
            {{ unknown() }}waar {{ person }} is. {{ witty( error(), chance ) }}
          {% else %}
            {{ location }}
          {% endif %}
        {% endif %}
        
        {% if call_rain_warning == 1 %}
          {{ rain_warning( witty ( bad_weather(), chance ) ) }}
        {% endif %}
        {% if call_langskomen == 1 %}
          {{ langskomen (kind) }}
        {% endif %}
        {% if call_leeslamp_weer_aan == 1 %}
          {{ leeslamp_weer_aan (kind) }}
        {% endif %}
        {{ CustomMessage }}
        {% if call_bye == 1 %}
          {{ bye() }}
        {% endif %}
        {% if call_shut_down == 1 %}
          {{ witty( shut_down(), chance) }}
        {% endif %}
        {% if call_new_device == 1 %}
          {{ new_device( witty( introduction(), chance) ) }}
        {% endif %}
        {% if call_dark_outside == 1 %}
          {{ dark_outside() }}
        {% endif %}
        {% if call_dark_inside == 1 %}
          {{ dark_inside() }}
        {% endif %}
        {% if call_guest_mode_on == 1 %}
          {{ guest_mode_on() }}
        {% endif %}
        {% if call_guest_mode_off == 1 %}
          {{ guest_mode_off() }}
        {% endif %}
        {% if call_responsibilities == 1 %}
          {{ responsibilities() }}
        {% endif %}
        {% if call_inside_weather == 1 %}
          {{ inside_weather() }}
        {% endif %}
        {% if call_outside_weather == 1 %}
          {{ outside_weather() }}
        {% endif %}
        {% if call_light_check == 1 %}
          {{ light_check() }}
        {% endif %}
        {% if call_door_check == 1 %}
          {{ door_check() }}
        {% endif %}
        {% if call_window_check == 1 or is_state('sun.sun', 'below_horizon') %}
          {{ window_check() }}
        {% endif %}
        {% if call_garage_check == 1 or is_state('sun.sun', 'below_horizon') %}
          {{ garage_check() }}
        {% endif %}
        {% if call_iss == 1 %}
          {{ iss() }}
        {% endif %}
        {% if call_moon == 1 %}
          {{ moon() }}
        {% endif %}
        {% if call_lampen_aan == 1 %}
          {{ lampen_aan (kamer) }}
        {% endif %}
        {% if call_lampen_uit == 1 %}
          {{ lampen_uit (kamer) }}
        {% endif %}
        {% if call_alarm_uit == 1 %}
          {{ alarm_uit() }}
        {% endif %}
        {% if call_firealarm == 1 %}
          {{ firealarm (kamer) }}
        {% endif %}
        {% if call_warning_rain == 1 %}
          {{ warning_rain (kamer) }}
        {% endif %}
        {% if call_work_arrive == 1 %}
          {{ work_arrive (person) }}
        {% endif %}
        {% if call_work_left == 1 %}
          {{ work_left (person) }}
        {% endif %}
        {{holiday_sentence()}}        
        {% if call_no_announcement != 1 %}
          {# call a Random fact about the house or inspiration quote #}
          {{ witty( ([iss, uv, moon, outside_weather, inspirational_quote,days_until("Martijn"),days_until("Suzanne"),days_until("Lars"),days_until("Nienke"),days_until_holiday()]|random)(), chance) }}
        {% endif %}

  - service: input_boolean.turn_off
    data:
      entity_id:
        - input_boolean.janet_alert_mode

######################################################################################################
##  janet_notification_hub is the bridge between the speech_engine and the processing units.        ##
######################################################################################################

janet_notification_hub:
  sequence:
  - service: script.janet_speech_processing
    data_template:
      media_player: >-
        {{ media_player }}
      speech_message: >-
        {{ speech_message }}
  - service: script.janet_text_processing 
    data_template:
      speech_message: >-
        {{ speech_message }}
######################################################################################################
##                  Within janet_speech_processing the TTS-service is called.                       ##
######################################################################################################

janet_speech_processing:
  sequence:
  - condition: and
    conditions:
      - condition: or
        conditions:
          - condition: time
            after: '07:00:00'
            before: '23:00:00'
          - condition: state
            entity_id: input_boolean.janet_alert_mode
            state: 'on'
      - condition: state
        entity_id: input_boolean.janet_speech_notifications
        state: 'on'
      - condition: or
        conditions:
          - condition: state
            entity_id: group.all_devices
            state: 'home'
          - condition: state
            entity_id: input_boolean.janet_guest_mode
            state: 'on'
    #TODO
  - wait_template: "{{ not is_state( media_player, 'playing') }}"
    timeout: 00:00:30

  - service: media_player.volume_set
    data_template:
      entity_id: >
        {{ media_player }}
      volume_level: >-
        {{ states.input_number.janet_notification_volume.state }}
  - service: tts.google_translate_say
    data_template:
      entity_id: >
        {{ media_player }}
      message: >-
          {{ speech_message | replace("\n","") | replace("   ","") | replace("  "," ") }}
      language: nl
#  - service: tts.google_translate_say
#    data_template:
#      message: >-
#          {{ speech_message | replace("\n","") | replace("   ","") | replace("  "," ") }}
#      language: nl
#    entity_id: group.google_home_group   
#  - service: tts.google_translate_say
#    data_template:
#      language: nl
#      entity_id: >
#        {{ media_player }}
#      message: >-
#          {{ speech_message | replace("\n","") | replace("   ","") | replace("  "," ") }}
######################################################################################################
##                  Within janet_text_processing the notify-service is called.                      ##
######################################################################################################

janet_text_processing:
  sequence:
  - condition: state
    entity_id: input_boolean.janet_text_notifications
    state: 'on'

  - service: notify.pushbullet
    data_template:
      #TODO
      title: "Janet:"
      message: >-
        {{ speech_message | replace("\n","") | replace("   ","") }}
      
######################################################################################################
      
'1569578493015':
  alias: random_kitchen
  sequence:
  # Check that it Extended Away mode is still on
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
    # Wait a random nmber of minutes between 15 and 90 and switch on
  - delay: '"00:{{ (range(15, 90)|random|int) }}:00"'
  - data:
      entity_id:
      - group.lampen_keuken
    service: light.turn_on
    # Wait for between 3 minutes and 9 minutes and switch off
  - delay: '"00:{{ (range(3, 9)|random|int) }}:00"'
  - data:
      entity_id:
      - group.lampen_keuken
    service: light.turn_off
  # Loop the script for next time.
  - service: script.random_kitchen_loop
'1569578623906':
  alias: random_kitchen_loop
  sequence:
  # Stop the calling script
  - service: homeassistant.turn_off
    entity_id: script.random_kitchen
  - delay: 00:05:00

  # Check that Extended Away mode is on and restart the script
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
  - service: script.random_kitchen
'15695764564906':
  alias: mockupancy
  sequence:
    # Wait until it is after 6pm and dark to start the routine
    - wait_template: "{{ states.sensor.time.state >= '18:00' and is_state('binary_sensor.dark_outside' , 'on') }}"

    # Check that it Extended Away mode is still on
    - condition: state
      entity_id: input_select.house_mode
      state: 'Extended Away'

    # Pick a random bedtime between 10pm and midnight.
    - service: input_datetime.set_time
      data_template:
        entity_id: input_datetime.mockupancy_bedtime
        time: "{{ (range(22, 23)|random|int) }}:{{ (range(0, 59)|random|int) }}:00"

    # Start the routine, switch on the 'usual' lights
    - data:
        entity_id:
        - group.lampen_woonkamer
      service: light.turn_on

    # Start scripts to randomise occasional lights
    #- service: script.random_master_bedroom
    - service: script.random_kitchen

    # Start scripts to randomise kids' bedtime simulation
    #- service: script.random_guest_room
    #- service: script.random_ashleys_room

    # 1 hour before bedtime, change lighting as if TV was turned off
    - wait_template: "{{ states('sensor.time') == (((state_attr('input_datetime.mockupancy_bedtime' , 'timestamp')) - (60 * 60))|timestamp_custom('%H:%M', false)) }}"
    - data:
        entity_id:
        - group.lampen_entree
        - group.lampen_hal
      service: light.turn_on

    # 20 minutes before bedtime, turn on kitchen lights only
    - wait_template: "{{ states('sensor.time') == (((state_attr('input_datetime.mockupancy_bedtime' , 'timestamp')) - (20 * 60))|timestamp_custom('%H:%M', false)) }}"
    - data:
        entity_id:
        - group.lampen_keuken
      service: light.turn_on

    # Stop kitchen/master bedroom randomisation
    - service: homeassistant.turn_off
      entity_id:
        #- script.random_master_bedroom
        #- script.random_master_bedroom_loop
        - script.random_kitchen
        - script.random_kitchen_loop

    # At 'bedtime', turn on Master Bedroom for random time between 2 and 15 minutes
    # turn off kitchen, wait 20-30 seconds, turn off living room wait 30-59 seconds,
    # turn on bedroom.
    - wait_template: "{{ states('sensor.time') == (state_attr('input_datetime.mockupancy_bedtime' , 'timestamp')|int|timestamp_custom('%H:%M', False)) }}"
    - service: homeassistant.turn_on
      entity_id: group.lampen_hal_boven
    - delay: "00:00:{{ (range(15, 59)|random|int) }}"
    - service: homeassistant.turn_off
      entity_id: group.lampen_woonkamer
    - delay: "00:00:{{ (range(20, 30)|random|int) }}"
    - service: homeassistant.turn_off
      entity_id: group.lampen_keuken
    - delay: "00:00{{ (range(20, 30)|random|int) }}"
    - service: homeassistant.turn_on
      entity_id: group.lampen_slaapkamer
      data:
        brightness: 80
    - delay: "00:{{ (range(2, 15)|random|int) }}:00"
    - service: homeassistant.turn_off
      entity_id: group.lampen_hal_boven
    - delay: "00:{{ (range(15, 59)|random|int) }}:00"
    - service: homeassistant.turn_off
      entity_id: group.lampen_slaapkamer

#    # After a random time between 15 minutes and an hour, turn off the lights
    - delay: "00:{{ (range(15, 30)|random|int) }}:00"
    - data:
        entity_id:
        - group.all_lights
      service: light.turn_off

    # If light before 7am, switch off lights, stop and loop, if not run a further script first
#    - wait_template: "{{ now().hour == 7 }}"
    - wait_template: "{{ states.sensor.time.state == '07:00' }}"
    - service_template: >
        {% if states('binary_sensor.dark_outside' , 'on') %} script.morning_mockupancy
        {% else %} script.mockupancy_loop {% endif %}
'156gdfgfsdfs3015':
  alias: mockupancy_loop
  sequence:
  # Switch off the lights, and make sure the calling scripts have stopped
  - service: homeassistant.turn_off
    entity_id:
      - group.all_lights
      - script.mockupancy
  - delay: 00:05:00

  # Check that it Extended Away mode is still on and restart the script for a new day
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
  - service: script.mockupancy
'156gdfgsdfg93015':
  alias: random_master_bedroom
  sequence:
  # Check that it Extended Away mode is still on
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
    # Wait a random nmber of minutes between 15 and 90 and switch on
  - delay: '"00:{{ (range(15, 90)|random|int) }}:00"'
  - data:
      entity_id:
      - group.lampen_slaapkamer
    service: light.turn_on
    # Wait for between 3 minutes and 9 minutes and switch off
  - delay: '"00:{{ (range(3, 9)|random|int) }}:00"'
  - data:
      entity_id:
      - group.lampen_slaapkamer
    service: light.turn_off
  # Loop the script for next time.
  - service: script.random_master_bedroom_loop
'15695gsdfgsdfg906':
  alias: random_master_bedroom_loop
  sequence:
  # Stop the calling script
  - service: homeassistant.turn_off
    entity_id: script.random_master_bedroom
  - delay: 00:05:00

  # Check that Extended Away mode is on and restart the script
  - condition: state
    entity_id: input_select.house_mode
    state: 'Extended Away'
  - service: script.random_master_bedroom
'156456456gsdfg906':
  alias: timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.cooking_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'15645fsfssdfg906':
  alias: timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.cooking_timer
'1564hfghdfgg906':
  alias: extended_away_timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.extended_away_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'1hdfghfghdfgg906':
  alias: extended_away_timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.extended_away_timer
'156fghdfghdf906':
  alias: kids_home_alone_timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.kids_home_alone_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'1566546346dfg906':
  alias: kids_home_alone_timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.kids_home_alone_timer
'15645634563456dfg906':
  alias: guests_timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.guests_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'15634563456g906':
  alias: guests_timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.guests_timer
'156456345fsdfsfsf':
  alias: fan_timer_start
  sequence:
    - service: timer.start
      data_template:
        entity_id: timer.fan_on_timer
        duration: '{{ states.input_number.timer_hours.state | int }}:{{ states.input_number.timer_minutes.state | int }}:{{ states.input_number.timer_seconds.state | int }}'
'156345637575675':
  alias: fan_timer_cancel
  sequence:
    - service: timer.cancel
      data:
        entity_id: timer.fan_on_timer